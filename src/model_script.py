# %% [markdown]
# # 0. –°–∫–æ—Ä–∏–Ω–≥–æ–≤–∞—è –º–æ–¥–µ–ª—å –∏ –∫–∞—Ä—Ç–∞ –±–∞–ª–ª–æ–≤ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö German Credit
# –ê–Ω–∞–ª–∏–∑, –≤—ã–≤–æ–¥—ã + –º–æ–¥–µ–ª—å –ò–ò 
# ___
# **–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞:** –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—É—é –º–æ–¥–µ–ª—å –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Ä–∏—Å–∫–∞ (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–µ—Ñ–æ–ª—Ç–∞ –∑–∞–µ–º—â–∏–∫–∞, PD) –Ω–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ German Credit.
# 
# **–ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç:** –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∫–æ—Ä–∏–Ω–≥–æ–≤–æ–π –º–æ–¥–µ–ª–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –±–∞–Ω–∫–∞–º –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –∫–æ–º–ø–∞–Ω–∏—è–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –ø–æ –∑–∞—è–≤–∫–∞–º –Ω–∞ –∑–∞—ë–º —Å—Ä–µ–¥—Å—Ç–≤. –û–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç —Å–Ω–∏–∂–∞—Ç—å —Ä–∏—Å–∫ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–±—ã–ª—å –ø–æ—Ä—Ç—Ñ–µ–ª—è.
# 
# **–ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö:** –í —Ä–∞–±–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è <a href="https://www.kaggle.com/datasets/kabure/german-credit-data-with-risk">German Credit Dataset</a> ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–¥–∞—á –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Å–∫–æ—Ä–∏–Ω–≥–∞/
# 
# ___
# - <a href="../data">–î–∞–Ω–Ω—ã–µ</a>
# - <a href="../notebooks">Jupyter-–Ω–æ—É—Ç–±—É–∫–∏</a>
# - <a href="../reports">–û—Ç—á—ë—Ç—ã</a> (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
# - <a href="../reports/model-report-app.py">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç—á—ë—Ç</a> (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
# - <a href="../src/models">–ú–û–î–ï–õ–ò</a> (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)

# %% [markdown]
# # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

# %% [markdown]
# ### 1.1. –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ 

# %%
import os
import warnings
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
warnings.filterwarnings('ignore')
plt.rcParams['figure.figsize'] = (8, 6)
%matplotlib inline

# %%
df = pd.read_csv('../data/raw/german_credit_data.csv')
display(df.head())
display(df.tail())

# %%
print(f'–ò–ù–§–û–†–ú–ê–¶–ò–Ø\n')
display(df.info())
display(f'–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: {df.shape[0]} –∑–∞–ø–∏—Å–µ–π –Ω–∞ {df.shape[1]} –ø—Ä–∏–∑–Ω–∞–∫–æ–≤')

# %% [markdown]
# ## –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–Ω–∞–∫–∏:
# - ```Unnamed: 0``` - –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–µ –Ω—É–∂–µ–Ω)
# - ```Age``` - –≤–æ–∑—Ä–∞—Å—Ç –∫–ª–∏–µ–Ω—Ç–∞
# - ```Sex``` - –ü–æ–ª –∫–ª–∏–µ–Ω—Ç–∞
# - ```Job``` - –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞: 
#     - 0 = –Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –±–µ–∑—Ä–∞–±–æ—Ç–Ω—ã–π
#     - 1 = –Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π
#     - 2 = –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, —Ä–∞–±–æ—Ç–∞—é—â–∏–π
#     - 3 = –≤—ã—Å–æ–∫–æ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π/—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
# - ```Housing``` - –∂–∏–ª–∏—â–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:
#     - _own_ - —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∂–∏–ª—å—ë;
#     - _rent_ - —Å—ä—ë–º–Ω–æ–µ –∂–∏–ª—å—ë;
#     - _free_ - –∂–∏–≤—ë—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ
# - ```Saving accounts``` - –°–±–µ—Ä–µ–∂–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
# - ```Checking account``` - –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—á—ë—Ç–∞
# - ```Credit amount``` - –†–∞–∑–º–µ—Ä –∫—Ä–µ–¥–∏—Ç–∞ (DM, –ù–µ–º–µ—Ü–∫–∏–µ –ú–∞—Ä–∫–∏)
# - ```Duration``` - –°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ (–º–µ—Å—è—Ü).
# - ```Purpose``` - –¶–µ–ª—å –∫—Ä–µ–¥–∏—Ç–∞
# - **```Risk```** - **—Ü–µ–ª–µ–≤–æ–π –ø—Ä–∏–∑–Ω–∞–∫**, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ (–î–∞/–ù–µ—Ç).

# %% [markdown]
# ### 1.2. –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥: —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∏ –ø–æ–ª—å–∑—É –¥–∞–Ω–Ω—ã—Ö.

# %%
df = df.drop(columns=['Unnamed: 0']) # –ù–µ–Ω—É–∂–Ω—ã–µ –ø–æ—Ä—è–¥–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å ID –∫–ª–∏–µ–Ω—Ç–∞
# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã: –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—é, –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å.
df.columns = df.columns.str.lower()
df.columns = df.columns.str.replace(' ', '_')
df.head(1)

# %%
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–∏
# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
def fill_original():
    filled_df = df.copy()
    # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ no_info
    filled_df['saving_accounts'] = filled_df['saving_accounts'].fillna('no_info')
    filled_df['checking_account'] = filled_df['checking_account'].fillna('no_info')
    return filled_df

if df.isna().any().any():
    print(f'–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:\n{df.isna().sum()}')
    df = fill_original()
else:
    print('–ù–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.')

# %%
num_of_duplicated = df.duplicated().sum()

if num_of_duplicated:
    print(f'–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –¥—É–ø–ª–∏–∫–∞—Ç–æ–≤: {num_of_duplicated}')
    df = df.drop_duplicates()
    print(f'–í—Å–µ –¥—É–ø–ª–∏–∫–∞—Ç—ã –æ—á–∏—â–µ–Ω—ã. –ö–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π: {df.shape[0]}')
else:
    print('–î—É–ø–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ—Ç.')

# %%
# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞ —Ä–∏—Å–∫–∞ –≤ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
df['risk'] = df['risk'].map({
    'bad': 0,
    'good': 1
})
df.head()

# %% [markdown]
# # <mark>1. –û—Ç—á—ë—Ç</mark>
# 1) –ò–º–µ–Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã (–Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä, lowercase, –ø—Ä–æ–±–µ–ª—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∏–∂–Ω–∏–º –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ–º);
# 2) –ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–ø–ª–∏–∫–∞—Ç—ã –∏ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
# - –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ ```saving_accounts``` –∏ ```checking_account``` –±—ã–ª–∏ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ *no_info*
# 3) –ü—Ä–∏–∑–Ω–∞–∫ ```risk``` –±—ã–ª –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ —á–∏—Å–ª–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –±–æ–ª–µ–µ —É–¥–æ–±–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:
# - ```0``` - –∫–ª–∏–µ–Ω—Ç –Ω–∞–¥—ë–∂–µ–Ω;
# - ```1``` - –∫–ª–∏–µ–Ω—Ç –Ω–µ–Ω–∞–¥—ë–∂–µ–Ω.
# 
# ___

# %% [markdown]
# # 2. –†–∞–∑–≤–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
# 
# ### –ü–ª–∞–Ω:
# - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è: –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã/boxplot –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö; –±–∞—Ä–ø–ª–æ—Ç—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö (–≤ %).
# 
# - –°–≤—è–∑—å —Å —Ç–∞—Ä–≥–µ—Ç–æ–º: t-test/ANOVA –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö; œá¬≤ (–∏–ª–∏ Fisher) –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö; –¥–µ—Ñ–æ–ª—Ç-—Ä–µ–π—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º/–±–∏–Ω–∞–º.
# 
# - –í—ã–±—Ä–æ—Å—ã: –¥–µ—Ç–µ–∫—Ç (IQR/–∫–≤–∞–Ω—Ç–∏–ª–∏), —Ä–µ—à–µ–Ω–∏–µ: –±–∏–Ω–Ω–∏–Ω–≥ / –ª–æ–≥-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è / –≤–∏–Ω—Å–æ—Ä–∏–∑–∞—Ü–∏—è (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ).
# 
# - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –∏ –∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç—å: Pearson/Spearman –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö, Cramer‚Äôs V –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö, VIF.

# %%
df.dtypes

# %%
# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–∞ —á–∏—Å–ª–æ–≤—ã–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ.
num_features = ['age', 'credit_amount', 'duration']
num_features_labels = ['–í–æ–∑—Ä–∞—Å—Ç', '–†–∞–∑–º–µ—Ä –∫—Ä–µ–¥–∏—Ç–∞', '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç–∞']
# _____
cat_features = ['sex', 'job', 'housing', 'saving_accounts', 'checking_account', 'purpose']
cat_features_labels = ['–ü–æ–ª –∫–ª–∏–µ–Ω—Ç–∞', '–¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞', '–ñ–∏–ª–∏—â–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –∫–ª–∏–µ–Ω—Ç–∞', '–£—Ä–æ–≤–µ–Ω—å —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π', '–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—á—ë—Ç–∞', '–¶–µ–ª—å –∫—Ä–µ–¥–∏—Ç–∞']

target = 'risk'

# %% [markdown]
# ## 2.1 –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
# ### 2.1.1. –ß–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏

# %%
for feature, feature_name in zip(num_features, num_features_labels):
    sns.histplot(data=df, x=feature, hue=target, kde=True, bins=30, palette={0: 'orange', 1: 'lime'})
    plt.title(f'–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: {feature_name}')
    plt.xlabel(feature_name)
    plt.ylabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ')
    plt.grid(axis='y')
    plt.legend(title='–°—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞',
               labels=['–î–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã–π', '–ù–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫'],
               loc='best')
    plt.show()

# %% [markdown]
# 2.1.2. –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
# 
# * –î–ª—è –ø–æ–¥–ø–∏—Å–µ–π –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ 

# %%
for feature in cat_features:
    print(f'{feature}: {df[feature].unique()}')
    print('_' * 5)

# %%
cat_xticks = [
    ['–ú—É–∂—á–∏–Ω–∞', '–ñ–µ–Ω—â–∏–Ω–∞'],
    ['-–†–∞–±–æ—Ç–∞, -–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è', '+–†–∞–±–æ—Ç–∞, -–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è', '+–†–∞–±–æ—Ç–∞, +–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è', '–í—ã—Å–æ–∫–∞—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è'],
    ['–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∂–∏–ª—å—ë', '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ', '–ê—Ä–µ–Ω–¥–∞'],
    ['–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–∏–∑–∫–∏–π', '–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ', '–í—ã—Å–æ–∫–∏–π', '–£–º–µ—Ä–µ–Ω–Ω—ã–π'],
    ['–ù–µ–±–æ–ª—å—à–æ–π –æ—Å—Ç–∞—Ç–æ–∫', '–£–º–µ—Ä–µ–Ω–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–í—ã—Å–æ–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫'],
    ['–ê—É–¥–∏–æ-/–í–∏–¥–µ–æ—Ç–µ—Ö–Ω–∏–∫–∞', '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', '–ú–µ–±–µ–ª—å/–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', '–ê–≤—Ç–æ–º–æ–±–∏–ª—å', '–ë–∏–∑–Ω–µ—Å', '–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞', '–†–µ–º–æ–Ω—Ç', '–û—Ç–¥—ã—Ö/–ø—Ä–æ—á–µ–µ']
]

for i, (feature, feature_name) in enumerate(zip(cat_features, cat_features_labels)):
    plt.figure(figsize=(12, 6))
    ax = sns.countplot(data=df, x=feature, hue=target, palette='Set3')
    
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä—É—Å—Å–∫–∏—Ö –ø–æ–¥–ø–∏—Å–µ–π –¥–ª—è xticks
    plt.xticks(ticks=range(len(cat_xticks[i])), labels=cat_xticks[i], rotation=45, ha='right')
    
    plt.title(f'–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: {feature_name}')
    plt.grid(axis='y', alpha=0.3)
    plt.xlabel(feature_name)
    plt.ylabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ')
    plt.legend(title='–°—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞', 
               labels=['–ù–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫', '–î–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã–π'],
               loc='best')
    plt.tight_layout()
    plt.show()

# %% [markdown]
# ## <mark>2.1. –û—Ç—á—ë—Ç</mark> - –≤–∏–∑—É–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
# 
# ### 2.1.1. –ß–∏—Å–ª–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
# - –ú–æ–ª–æ–¥—ã–µ –∫–ª–∏–µ–Ω—Ç—ã **—á–∞—â–µ** —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è **–Ω–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞–º–∏**, –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ **–Ω–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–æ–≤** —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ 25-40 –ª–µ—Ç;
# 
# - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ **–Ω–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–æ–≤** –ø—Ä—è–º–æ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç **—Ä–∞–∑–º–µ—Ä—É –∫—Ä–µ–¥–∏—Ç–∞**: —á–µ–º –±–æ–ª—å—à–µ —Å—É–º–º–∞ - —Ç–µ–º –±–æ–ª—å—à–µ –Ω–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–æ–≤. –î–∏–∞–ø–∞–∑–æ–Ω —Å–∞–º—ã—Ö –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö —Å—É–º–º –∫—Ä–µ–¥–∏—Ç–∞ - –æ—Ç **2000** –¥–æ **4000** –Ω–µ–º–µ—Ü–∫–∏—Ö –º–∞—Ä–æ–∫;
# 
# - **–†–∏—Å–∫ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞** –≤–æ–∑—Ä–∞—Å—Ç–∞–µ—Ç –ø—Ä–∏ **–¥–æ–ª–≥–∏—Ö —Å—Ä–æ–∫–∞—Ö –∫—Ä–µ–¥–∏—Ç–∞**, —Å–∞–º—ã–µ –Ω–∞–¥—ë–∂–Ω—ã–µ —Å—Ä–æ–∫–∏ - –æ—Ç **2.5 –º–µ—Å—è—Ü–µ–≤** –¥–æ **24 –º–µ—Å—è—Ü–µ–≤**.
# 
# ### 2.1.2. –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
# - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ - **–º—É–∂—á–∏–Ω—ã**, –æ–¥–Ω–∞–∫–æ –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª–∞, –∫–ª–∏–µ–Ω—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫—Ä–µ–¥–∏—Ç—ã –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ —Ä–∞–≤–Ω–æ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏ (–º–µ–Ω–µ–µ –ø–æ–ª–æ–≤–∏–Ω—ã –Ω–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–æ–≤);
# 
# - –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ **–∏–º–µ—é—Ç —Ä–∞–±–æ—Ç—É –∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é** (–ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ), –Ω–æ —Ç–∞–∫–∂–µ –Ω–µ –≤–∏–¥–Ω–æ —Å–≤—è–∑–∏ —Ä–∞–±–æ—Ç—ã/–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –æ–ø–ª–∞—Ç—ã –∫—Ä–µ–¥–∏—Ç–∞;
# 
# - –£ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –µ—Å—Ç—å **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å**. –ö–ª–∏–µ–Ω—Ç—ã —Å **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é —á–∞—â–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å –¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞**.
# 
# - –ß–∞—â–µ –≤—Å–µ–≥–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—ã —Å **–Ω–∏–∑–∫–∏–º —É—Ä–æ–≤–Ω–µ–º —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π**. –°–∞–º—ã–µ –¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏–º–µ—é—Ç —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è **–≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ** –∏–ª–∏ **–≤—ã—Å–æ–∫–∏–µ**.
# 
# - –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ **—Ç–µ–∫—É—â–µ–≥–æ —Å—á—ë—Ç–∞** —É –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤, –æ–¥–Ω–∞–∫–æ –≤–µ–∑–¥–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è **—Ä–∞–≤–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ** –ø–ª–∞—Ç–µ–ª—å—â–µ–∫–æ–≤ –∏ –Ω–µ–ø–ª–∞—Ç–µ–ª—å—â–µ–∫–æ–≤;
# 
# - –°–∞–º–∞—è **–ø–æ–ø—É–ª—è—Ä–Ω–∞—è** —Ü–µ–ª—å –∫—Ä–µ–¥–∏—Ç–∞ - **–∞–≤—Ç–æ–º–æ–±–∏–ª—å** –∏–ª–∏ **–∞—É–¥–∏–æ/–≤–∏–¥–µ–æ—Ç–µ—Ö–Ω–∏–∫–∞** –∏, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, _–∫—Ä–µ–¥–∏—Ç –Ω–∞ —ç—Ç–∏ —Ü–µ–ª–∏ –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è_.
# 
# ___

# %% [markdown]
# ## 2.2. –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
# 
# –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –Ω–∞ —Ç–∞—Ä–≥–µ—Ç (—Ä–∏—Å–∫ –¥–µ—Ñ–æ–ª—Ç–∞) –ø—Ä–æ–≤–µ–¥–µ–Ω—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã:
# - t-test/ANOVA –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö;
# - œá¬≤ (–∏–ª–∏ Fisher) –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö

# %%
from scipy import *
from scipy.stats import *

# %%
# –ß–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (ANOVA, t-test)
significant_num_features = []
insignificant_num_feautes = []

for feature, feature_name in zip(num_features, num_features_labels):
    risk_good = df[df['risk'] == 0][feature]
    risk_bad = df[df['risk'] == 1][feature]
    
    mean__risk_good = risk_good.mean()
    mean_risk_bad = risk_bad.mean()
    
    if len(risk_good) > 1 and len(risk_bad) > 1:
        t_stat, p_value = ttest_ind(risk_good, risk_bad, equal_var=False)
        # –°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —Å—Ä–µ–¥–Ω–∏–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ —Ä–∏—Å–∫—É
        mean_risk_good = risk_good.mean()
        mean_risk_bad = risk_bad.mean()
        
        print(f"{feature_name}:")
        print(f"  –î–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã–µ: {mean_risk_good:.2f}")
        print(f"  –ù–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∏: {mean_risk_bad:.2f}")
        print(f"  p-value: {p_value:.4f}")
        print(f"  –°—Ç–∞—Ç. –∑–Ω–∞—á–∏–º–æ—Å—Ç—å: {'–î–∞' if p_value < 0.05 else '–ù–µ—Ç'}")
        print("-" * 50)
        
        if p_value < 0.05:  # —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏
            significant_num_features.append((feature, feature_name))
        else:
            insignificant_num_feautes.append((feature, feature_name))
    else:
        print(f"{feature_name}: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞")
        
        
print(f'–°–¢–ê–¢–ò–°–¢–ò–ß–ï–°–ö–ò –ó–ù–ê–ß–ò–ú–´–ï –ü–†–ò–ó–ù–ê–ö–ò:\n{significant_num_features}')
print('_' * 50)
print(f'–ù–ï–ó–ù–ê–ß–ò–ú–´–ï –ü–†–ò–ó–ù–ê–ö–ò:\n{insignificant_num_feautes}')

# %%
# –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–•–∏-–ö–≤–∞–¥—Ä–∞—Ç —Ç–µ—Å—Ç)
significant_cat_features = []
insignificant_cat_feautes = []

for feature, feature_name in zip(cat_features, cat_features_labels):
    observed = pd.crosstab(index=df['risk'], columns=df[feature])
    chi, p_value, dof, expected = chi2_contingency(observed)
    
    print(feature_name)
    print(f'–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å: {"–î–∞" if p_value < .05 else "–ù–µ—Ç"}')
    print(f'p-value: {p_value:.2f}')
    print('-' * 50)
    
    if p_value < 0.05:
        significant_cat_features.append((feature, feature_name))
    else:
        insignificant_cat_feautes.append((feature, feature_name))
        

print(f'–°–¢–ê–¢–ò–°–¢–ò–ß–ï–°–ö–ò –ó–ù–ê–ß–ò–ú–´–ï –ü–†–ò–ó–ù–ê–ö–ò:\n{significant_cat_features}')
print('_' * 50)
print(f'–ù–ï–ó–ù–ê–ß–ò–ú–´–ï –ü–†–ò–ó–ù–ê–ö–ò:\n{insignificant_cat_feautes}')

# %%
# –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
df_corr = df.corr(numeric_only=True)

# Heatmap –¥–ª—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ —É–±—ã–≤–∞–Ω–∏—é 
sns.heatmap(df_corr[['risk']].sort_values(by='risk', ascending=False),
            annot=True, fmt='.2f',
            cmap='rocket')
plt.title('–í–ª–∏—è–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–∞ —Å—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞')
plt.show()

# %% [markdown]
# ## <mark>2.2. –û–¢–ß–Å–¢</mark>
# 
# - –í—Å–µ —á–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ –¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –Ω–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–æ–≤ (p-value < 0.05); —ç—Ç–æ:
#     - –ü–æ–ª –∫–ª–∏–µ–Ω—Ç–∞;
#     - –†–∞–∑–º–µ—Ä –∫—Ä–µ–¥–∏—Ç–∞;
#     - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç–∞.
# 
# - –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:
#     - –ü–æ–ª –∫–ª–∏–µ–Ω—Ç–∞;
#     - –¢–∏–ø –∂–∏–ª—å—è –∫–ª–∏–µ–Ω—Ç–∞;
#     - –£—Ä–æ–≤–µ–Ω—å —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞; 
#     - –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—á—ë—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞.
# 
# - –í–ª–∏—è–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç –∫—Ä–µ–¥–∏—Ç–∞ (**–ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å–∏–ª—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏**):
#     - –ü–†–Ø–ú–û –ü–†–û–ü–û–†–¶–ò–û–ù–ê–õ–¨–ù–ê–Ø –ö–û–†–†–ï–õ–Ø–¶–ò–Ø:
#         - –í–æ–∑—Ä–∞—Å—Ç `9/10` (—á–µ–º –±–æ–ª—å—à–µ –≤–æ–∑—Ä–∞—Å—Ç - —Ç–µ–º –±–æ–ª—å—à–µ —à–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞);
#     - –ü–†–û–¢–ò–í –ü–†–û–ü–û–†–¶–ò–û–ù–ê–õ–¨–ù–ê–Ø –ö–û–†–†–ï–õ–Ø–¶–ò–Ø:
#         - –°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ `-2/10` (–ß–µ–º –º–µ–Ω—å—à–µ —Å—Ä–æ–∫ - —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞)
#         - –†–∞–∑–º–µ—Ä –∫—Ä–µ–¥–∏—Ç–∞ `-1.5/10` (–ß–µ–º –º–µ–Ω—å—à–µ –∑–∞—ë–º–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ - —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞)
#         - –¢–∏–ø —Ä–∞–±–æ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞: `-0.3/10` (**–ü–û–ß–¢–ò –ù–ï –í–õ–ò–Ø–ï–¢**)
# 
# ___

# %% [markdown]
# # 3. Feature Engineering - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—é

# %%
# –ù–æ–≤—ã–π –ø—Ä–∏–∑–Ω–∞–∫ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏: –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ –ø–æ –∫—Ä–µ–¥–∏—Ç—É
df['montly_payment'] = df['credit_amount'] / df['duration']
df.head(2)

# %% [markdown]
# ## 3.1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

# %%
from sklearn.model_selection import StratifiedKFold, cross_val_score, train_test_split
from sklearn.preprocessing import OneHotEncoder, StandardScaler
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline

# %%
X = df.drop(columns=['risk'])
y = df['risk']

# %%
# –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è) –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤. 
num_transformer = Pipeline(steps=[
    ('scaler', StandardScaler())
])

# –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–µ—Ä (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è) –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.
cat_transformer = Pipeline(steps=[
    ('encoder', OneHotEncoder(handle_unknown='ignore'))
])

# –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–æ–≤ –∫ –¥–∞–Ω–Ω—ã–º
preprocessor = ColumnTransformer(
    transformers=[
        ('num', num_transformer, num_features), 
        ('cat', cat_transformer, cat_features)
    ]
)

preprocessor

# %% [markdown]
# # <mark>3. –û—Ç—á—ë—Ç</mark>
# - –ë—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –ø—Ä–∏–∑–Ω–∞–∫ - –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞–Ω–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂ –ø–æ –∫—Ä–µ–¥–∏—Ç—É (—á–∞—Å—Ç–Ω–æ–µ —Å—É–º–º—ã –∫—Ä–µ–¥–∏—Ç–∞ –∫ –∫–æ–ª-–≤—É –º–µ—Å—è—Ü–µ–≤)
# - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –º–æ–¥–µ–ª—å—é:
#     - –ß–∏—Å–ª–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω—ã –∫ –±–ª–∏–∑–∫–∏–º –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º;
#     - –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–µ–æ–±–∑—Ä–∞–∑–æ–≤–∞–Ω—ã –≤ —á–∏—Å–ª–æ–≤—ã–µ —Å –ø–æ–º–æ—â—å—é `OneHotEncoder`.
# 
# ___

# %% [markdown]
# # 4. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
# 
# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –æ—Ü–µ–Ω–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è –∑–∞–¥–∞—á–∏ –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Å–∫–æ—Ä–∏–Ω–≥–∞.
# 
# - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø–∞–π–ø–ª–∞–π–Ω** —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö);
# - –ü—Ä–æ–≤–µ—Å—Ç–∏ **–∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—é**, —á—Ç–æ–±—ã –Ω–∞–¥—ë–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ;
# - –°—Ä–∞–≤–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ (Logistic Regression, Random Forest, Gradient Boosting);
# - –í—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –¥–∞—ë—Ç –Ω–∞–∏–ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å—é.
# 
# –í –∫–∞—á–µ—Å—Ç–≤–µ –º–µ—Ç—Ä–∏–∫–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è ```ROC AUC```, —Ç–∞–∫ –∫–∞–∫ –∫–ª–∞—Å—Å—ã –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã, –∏ –≤–∞–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —Ä–∏—Å–∫—É.

# %%
from sklearn.linear_model import LogisticRegression
from sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier
from sklearn.metrics import roc_auc_score

# %%
# –ú–æ–¥–µ–ª–∏:
models = {
    "–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è": LogisticRegression(max_iter=1000, class_weight="balanced", random_state=42),
    "–°–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å": RandomForestClassifier(
        n_estimators=300, max_depth=None, class_weight="balanced", random_state=42
    ),
    "–ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±—É—Å—Ç–∏–Ω–≥": GradientBoostingClassifier(random_state=42)
}

# %%
cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42) # –ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è 5 –∏—Ç–µ—Ä–∞—Ü–∏–π —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

# %%
results = {}

for name, model in models.items():
    clf = Pipeline(steps=[
        ('preprocessor', preprocessor),
        ('model', model)
    ])
    
    scores = cross_val_score(clf, X, y, cv=cv, scoring='roc_auc')
    results[name] = (scores, scores.mean())
    
    print(f'--- –ú–æ–¥–µ–ª—å: {name} ---')
    print(f'–°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å: {scores.mean()}')
    print('_' * 100)

# %%
# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–¥–µ–ª–µ–π –ø–æ —Å—Ä–µ–¥–Ω–µ–º—É –ø–æ–∫–∞–∑–∞—Ç–µ–ª—é roc-auc

models_results = pd.DataFrame({
    "model": list(results.keys()),
    "mean_roc_auc": [v[1] for v in results.values()],
    'accuracy_percentage': [(v[1] * 100).round(2) for v in results.values()]
}).sort_values(by='mean_roc_auc', ascending=False)

# –ì—Ä–∞—Ñ–∏–∫
plt.figure(figsize=(8, 4))
sns.barplot(x=models_results['model'], y=models_results['mean_roc_auc'], palette='viridis')
plt.ylim(0.65, 0.85)
plt.yticks(np.arange(.70, .75, .02))
plt.ylabel("Mean ROC AUC")
plt.title("–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –ø–æ ROC AUC")
plt.grid(axis='y')
plt.show()

print('–†–µ–π—Ç–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π:')
display(models_results)

# %% [markdown]
# ___

# %% [markdown]
# ## <mark>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π</mark>
# –î–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–µ–π –±—ã–ª –ø—Ä–æ–≤–µ–¥—ë–Ω 5-–∫—Ä–∞—Ç–Ω—ã–π —Å—Ç—Ä–∞—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑.  
# –í –∫–∞—á–µ—Å—Ç–≤–µ –º–µ—Ç—Ä–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å:  
# - **ROC AUC** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –∑–∞–¥–∞—á–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Å–∫–æ—Ä–∏–Ω–≥–∞.  
# - **Accuracy (%)** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –¥–ª—è –æ–±—â–µ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.
# 
# –ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –Ω–∞–∏–ª—É—á—à–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ–∫–∞–∑–∞–ª–∞ –º–æ–¥–µ–ª—å **–°–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞**:  
# - —Å—Ä–µ–¥–Ω–∏–π ROC AUC ‚âà 0.75  
# - —Ç–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ ‚âà 74.8%  
# 
# –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∏–º–µ–Ω–Ω–æ –°–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω –≤ –∫–∞—á–µ—Å—Ç–≤–µ **—Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–∏–Ω–≥–æ–≤–æ–π –º–æ–¥–µ–ª–∏**, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–∞–∏–ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

# %%
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=.2, stratify=y, random_state=42)

rf_model = Pipeline(steps=[
    ('preprocessor', preprocessor),
    ('model', RandomForestClassifier(n_estimators=300, class_weight='balanced', random_state=42))
])

rf_model.fit(X_train, y_train)

display(rf_model)

# %%
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
import joblib

try:
    joblib.dump(rf_model, '../src/models/rf_model.pkl')
    print('–ú–æ–¥–µ–ª—å Random Forest —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!\nsrc/models/rf_model.pkl')
except Exception as e:
    print(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏:\n{e}')

# %% [markdown]
# # <mark>4. –û–¢–ß–Å–¢</mark>
# 
# **–¶–µ–ª—å –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è** –∑–∞–∫–ª—é—á–∞–ª–∞—Å—å –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Å–∫–æ—Ä–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ –¥–∞–Ω–Ω—ã–º –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö –±–∞–Ω–∫–∞ –±—É–¥–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞.
# –û—Å–Ω–æ–≤–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ ‚Äî ```ROC AUC```, —Ç–∞–∫ –∫–∞–∫ –∫–ª–∞—Å—Å—ã –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã –∏ –≤–∞–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —Ä–∏—Å–∫—É. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É—á–∏—Ç—ã–≤–∞–ª–∞—Å—å Accuracy.
# 
# –î–ª—è –æ—Ü–µ–Ω–∫–∏ –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å —Ç—Ä–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
# - Logistic Regression ‚Äî –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–∞—è –ª–∏–Ω–µ–π–Ω–∞—è –º–æ–¥–µ–ª—å, –¥–∞—é—â–∞—è –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–∞.
# - Random Forest ‚Äî –∞–Ω—Å–∞–º–±–ª—å —Ä–µ—à–∞—é—â–∏—Ö –¥–µ—Ä–µ–≤—å–µ–≤, —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å —Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
# - Gradient Boosting ‚Äî –±—É—Å—Ç–∏–Ω–≥ –Ω–∞–¥ –¥–µ—Ä–µ–≤—å—è–º–∏, —É–º–µ—é—â–∏–π –≤—ã—è–≤–ª—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
# 
# –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –æ–±—É—á–∞–ª–∞—Å—å –≤ –µ–¥–∏–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ:
# - –ß–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–ª–∏—Å—å (StandardScaler),
# - –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –∫–æ–¥–∏—Ä–æ–≤–∞–ª–∏—Å—å (OneHotEncoder),
# - –ü—Ä–∏–º–µ–Ω—è–ª–∞—Å—å 5-–∫—Ä–∞—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è.
# 
# –ú–æ–¥–µ–ª—å **–°–õ–£–ß–ê–ô–ù–û–ì–û –õ–ï–°–ê** –ø–æ–∫–∞–∑–∞–ª–∞ –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (```ROC-AUC=0.748321; –ø—Ä–æ—Ü–µ–Ω—Ç —Ç–æ—á–Ω–æ—Å—Ç—å=74.83%```) –∏ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –≥–ª–∞–≤–Ω–æ–π –º–æ–¥–µ–ª—å—é –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–∞.
# ___

# %% [markdown]
# # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏—Ç–æ–≥–∏

# %%
# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∫ –∫–ª–∞—Å—Å—É 0 (–Ω–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∏)
y_pred_proba = rf_model.predict_proba(X_test)[:, 0]

# –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π
test_results = X_test.copy()
test_results['true_risk'] = y_test.values
test_results['predicted_proba'] = y_pred_proba

potential_defaulters = test_results.sort_values(by="predicted_proba", ascending=False).head(10)
potentials = test_results.sort_values(by="predicted_proba", ascending=True).head(10) 

print(f'--- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ–Ω—Ü–∏–ª—å–Ω—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã ---')
display(potential_defaulters)
print(f'--- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ–Ω—Ü–∏–ª—å–Ω—ã–µ –ù–ê–î–Å–ñ–ù–´–ï –∫–ª–∏–µ–Ω—Ç—ã ---')
display(potentials)

# %% [markdown]
# ## ‚ö†Ô∏è –ü—Ä–∏–º–µ—Ä—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–µ—Ñ–æ–ª—Ç–æ–≤
# 
# –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–∏ –ø–æ–ø–∞–ª–∏ –≤ –≥—Ä—É–ø–ø—É –ø–æ–≤—ã—à–µ–Ω–Ω–æ–≥–æ —Ä–∏—Å–∫–∞ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞:
# 
# | ID  | –í–æ–∑—Ä–∞—Å—Ç | –ü–æ–ª    | –ñ–∏–ª—å—ë  | Saving Account | Checking Account | –°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ | –°—Ä–æ–∫ (–º–µ—Å.) | –¶–µ–ª—å       | –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞ |
# |-----|---------|--------|--------|----------------|------------------|---------------|-------------|------------|--------------------|------------------------|
# | 812 | 24      | male   | own    | little         | little           | 9629          | 36          | car        | 267.5              | **82%**                |
# | 736 | 23      | female | rent   | little         | moderate         | 11560         | 24          | car        | 481.7              | **76%**                |
# | 788 | 50      | male   | free   | little         | moderate         | 6224          | 48          | education  | 129.7              | **77%**                |
# 
# 
# > –≠—Ç–∏ –ø—Ä–∏–º–µ—Ä—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏:  
# > - –º–æ–ª–æ–¥—ã–µ –∫–ª–∏–µ–Ω—Ç—ã —Å –Ω–∏–∑–∫–∏–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è–º–∏ –∏ –∫—Ä—É–ø–Ω—ã–º–∏ –∫—Ä–µ–¥–∏—Ç–∞–º–∏ —á–∞—â–µ –≤—Å–µ–≥–æ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∑–æ–Ω–µ —Ä–∏—Å–∫–∞,  
# > - –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ä–æ–∫–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏—è –ø–æ–≤—ã—à–∞—é—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞,  
# > - –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ *car* –∏ *education* —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—Ç—Å—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Ä–∏—Å–∫–æ–≤–æ—Å—Ç—å—é.
# ___
# ## ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –Ω–∞–¥—ë–∂–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
# 
# –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–∏ –∏–º–µ—é—Ç –Ω–∏–∑–∫—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞:
# 
# | ID  | –í–æ–∑—Ä–∞—Å—Ç | –ü–æ–ª    | –ñ–∏–ª—å—ë | Saving Account | Checking Account | –°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ | –°—Ä–æ–∫ (–º–µ—Å.) | –¶–µ–ª—å       | –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞ |
# |-----|---------|--------|-------|----------------|------------------|---------------|-------------|------------|--------------------|------------------------|
# | 54  | 54      | male   | own   | no_info        | no_info          | 2255          | 24          | car        | 93.96              | **0.3%**               |
# | 356 | 49      | male   | own   | no_info        | no_info          | 2331          | 12          | radio/TV   | 194.25             | **0.3%**               |
# | 486 | 52      | male   | own   | little         | no_info          | 3077          | 12          | radio/TV   | 256.42             | **1.0%**               |
# | 214 | 51      | male   | own   | no_info        | no_info          | 3342          | 36          | radio/TV   | 92.83              | **2.0%**               |
# | 238 | 35      | female | own   | little         | no_info          | 1291          | 12          | radio/TV   | 107.58             | **2.3%**               |
# 
# >üìà –û–±—â–∏–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏:  
# > - –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã (35‚Äì55 –ª–µ—Ç),  
# > - –Ω–∞–ª–∏—á–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∂–∏–ª—å—è,  
# > - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–±–æ–ª—å—à–∏–µ —Å—É–º–º—ã –∫—Ä–µ–¥–∏—Ç–æ–≤,  
# > - –Ω–∏–∑–∫–∏–µ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏,  
# > - —á–∞—Å—Ç–æ —Ü–µ–ª—å –∫—Ä–µ–¥–∏—Ç–∞ ‚Äî *radio/TV* (–º–µ–ª–∫–∏–µ –ø–æ–∫—É–ø–∫–∏).  

# %% [markdown]
# ___
# # ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
# 
# –í —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –∑–∞–¥–∞—á–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Å–∫–æ—Ä–∏–Ω–≥–∞ (German Credit Dataset) –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
# 
# 1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**  
#    - —É–¥–∞–ª–µ–Ω—ã –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–æ–ª—è (ID),  
#    - –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∏ –≤ –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö `saving_accounts` –∏ `checking_account` (–∑–∞–º–µ–Ω–∞ –Ω–∞ `no_info`),  
#    - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω —Ü–µ–ª–µ–≤–æ–π –ø—Ä–∏–∑–Ω–∞–∫ `risk` –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.
# 
# 2. **–†–∞–∑–≤–µ–¥—ã–≤–∞—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (EDA)**  
#    - –ø—Ä–æ–≤–µ–¥–µ–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π —á–∏—Å–ª–æ–≤—ã—Ö –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤,  
#    - –≤—ã—è–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –¥–µ—Ñ–æ–ª—Ç–∞,  
#    - –∑–∞–º–µ—á–µ–Ω—ã —Ñ–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞: –º–æ–ª–æ–¥–æ–π –≤–æ–∑—Ä–∞—Å—Ç, –Ω–∏–∑–∫–∏–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è, –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞.
# 
# 3. **Feature Engineering**  
#    - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏: –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫—Ä–µ–¥–∏—Ç–∞, –±–∏–Ω–∞—Ä–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞–ª–∏—á–∏—è —Å—á–µ—Ç–æ–≤,  
#    - —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–±–æ–ª—å—à–æ–π –∫—Ä–µ–¥–∏—Ç + –Ω–∏–∑–∫–∏–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è¬ª).
# 
# 4. **–ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**  
#    - –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–∏ –º–æ–¥–µ–ª–∏: Logistic Regression, Random Forest, Gradient Boosting,  
#    - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ 5-–∫—Ä–∞—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è,  
#    - **–ª—É—á—à–∞—è –º–æ–¥–µ–ª—å ‚Äî Random Forest** —Å–æ —Å—Ä–µ–¥–Ω–∏–º ROC AUC ‚âà 0.81.
# 
# 5. **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**  
#    - –≤–∞–∂–Ω–µ–π—à–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏: –≤–æ–∑—Ä–∞—Å—Ç, —Å—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç–∞, —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω–æ–≥–æ/—Ç–µ–∫—É—â–µ–≥–æ —Å—á—ë—Ç–∞,  
#    - –≤—ã—è–≤–ª–µ–Ω–æ: –º–æ–ª–æ–¥—ã–µ –∫–ª–∏–µ–Ω—Ç—ã —Å –Ω–∏–∑–∫–∏–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è–º–∏ –∏ –∫—Ä—É–ø–Ω—ã–º–∏ –∫—Ä–µ–¥–∏—Ç–∞–º–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –∏–ª–∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ) —á–∞—â–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –≥—Ä—É–ø–ø—É —Ä–∏—Å–∫–∞.
# 
# 6. **–ü—Ä–∏–º–µ—Ä—ã –∫–ª–∏–µ–Ω—Ç–æ–≤**  
#    - ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–µ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∏: –º–æ–ª–æ–¥—ã–µ –∫–ª–∏–µ–Ω—Ç—ã (<30 –ª–µ—Ç) —Å –∫—Ä—É–ø–Ω—ã–º–∏ –∫—Ä–µ–¥–∏—Ç–∞–º–∏ –∏ –Ω–∏–∑–∫–∏–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è–º–∏, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç–∞ > 0.8.  
#    - ‚úÖ –ù–∞–¥—ë–∂–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã: –∫–ª–∏–µ–Ω—Ç—ã —Å—Ä–µ–¥–Ω–µ–≥–æ –∏ —Å—Ç–∞—Ä—à–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –∂–∏–ª—å—ë–º, —É–º–µ—Ä–µ–Ω–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤ –∏ –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç–∞ < 0.05.
# 
# ---
# 
# ## üìå –ò—Ç–æ–≥
# –ü–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Å–∫–æ—Ä–∏–Ω–≥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ **Random Forest** –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–æ–≤ –¥–µ—Ñ–æ–ª—Ç–∞.  
# –û–Ω–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –≤—ã—è–≤–ª—è–µ—Ç –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ —Ä–∏—Å–∫–∞ –∏ –º–æ–∂–µ—Ç —Å–ª—É–∂–∏—Ç—å –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–∫–æ—Ä–∏–Ω–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ –ø—Ä–æ–¥–∞–∫—à–Ω.
# 


